<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Balance Permutation Test â€¢ MLbalance</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Balance Permutation Test">
<meta name="description" content="This package implements a novel machine learning balance test, the balance permutation test, for experimental data. The purpose of this test is to detect unintentional failures of random assignment, data fabrication, or simple covariate imbalance. Our implemenation employs honest, boosted random forests with native parallel processing, hyperparameter tuning, and the ability to handle missingness in pre-treatment covariates.">
<meta property="og:description" content="This package implements a novel machine learning balance test, the balance permutation test, for experimental data. The purpose of this test is to detect unintentional failures of random assignment, data fabrication, or simple covariate imbalance. Our implemenation employs honest, boosted random forests with native parallel processing, hyperparameter tuning, and the ability to handle missingness in pre-treatment covariates.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">MLbalance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CetiAlphaFive/MLbalance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="mlbalance-">MLbalance <a href="https://github.com/samjfuller/MLbalance/blob/master/man/figures/mlbalance_sticker.png" class="external-link"><img src="reference/figures/mlbalance_sticker.png" align="right" height="139"></a>
<a class="anchor" aria-label="anchor" href="#mlbalance-"></a>
</h1></div>
<p>MLbalance implements a novel machine learning balance test, the balance permutation test, for experiments with binary, multiarm, and continuous treatments. The purpose of this test is to detect failures of random assignment, data fabrication, or imbalance across treatment arms. For more detail, see <a href="https://osf.io/preprints/osf/xcwt9" class="external-link">Rametta and Fuller (2024)</a>.</p>
<p>This package is in development, any recommendations or comments welcome in the issues section.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Stable version is be available on Github here:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"MLCause/MLbalance"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of MLbalance from <a href="https://github.com/CetiAlphaFive/MLbalance" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"CetiAlphaFive/MLbalance"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binary-treatment-example">Binary Treatment Example<a class="anchor" aria-label="anchor" href="#binary-treatment-example"></a>
</h2>
<p>Here is a basic example demonstrating the balance permutation test on a simulated binary treatment DGP with multidimensional contamation of the treatment assignment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("randomizr")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CetiAlphaFive/MLbalance" class="external-link">MLbalance</a></span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1995</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Simple simulation </span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">n</span>,<span class="va">p</span><span class="op">)</span></span>
<span><span class="va">w_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fl">.021</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">.5</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">.021</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">.5</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># install.packages("randomizr")</span></span>
<span><span class="va">w_sim</span> <span class="op">&lt;-</span> <span class="fu">randomizr</span><span class="fu">::</span><span class="fu">complete_ra</span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span>,m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w_real</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">w_real</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">+</span> <span class="va">e</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">w_real</span>,<span class="va">w_sim</span>,<span class="va">X</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">r.check</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/random_check.html">random_check</a></span><span class="op">(</span>W_real <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">w_real</span>, <span class="co">#real treatment assignment vector </span></span>
<span>                        W_sim  <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">w_sim</span>, <span class="co">#simulated vector, comment out this argument to use permutated real assignment vector instead </span></span>
<span>                        X      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df</span>,select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">w_real</span>,<span class="va">w_sim</span><span class="op">)</span><span class="op">)</span> <span class="co">#matrix of pretreatment covariates (or any covariates that SHOULD NOT be related to the assignment process/mechanism</span></span>
<span>             <span class="op">)</span>; <span class="va">r.check</span><span class="op">$</span><span class="va">plot</span></span>
<span><span class="co">#&gt; Simulated Assignment Vector Provided, Null Distribution Generated Using Simulated Treatment Assignment.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simple Count Table(s)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; W_real</span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 520 480 </span></span>
<span><span class="co">#&gt; W_sim</span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 520 480 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Warning: Extreme Propensity scores detected (greater than .9 or less than .1).</span></span>
<span><span class="co">#&gt;                                       Examine $treat.props for more detail.</span></span></code></pre></div>
<p><img src="reference/figures/README-example-1.png" width="100%"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to see variables important for predicting assignment, check r.check$imp.predictors </span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/CetiAlphaFive/MLbalance/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MLbalance</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jack T. Rametta <br><small class="roles"> Author, maintainer </small>  </li>
<li>Sam Fuller <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jack T. Rametta, Sam Fuller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
